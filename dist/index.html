<!DOCTYPE html>
<html>
    <head>
        테스트용
        <script src="https://code.jquery.com/jquery-3.7.1.slim.js" integrity="sha256-UgvvN8vBkgO0luPSUl2s8TIlOSYRoGFAX4jlCIm9Adc=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery.json-viewer@1.5.0/json-viewer/jquery.json-viewer.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/jquery.json-viewer@1.5.0/json-viewer/jquery.json-viewer.css" type="text/css" rel="stylesheet">
    </head>
    <body>
        <pre id="json-renderer"></pre>
        <ul id="list"></ul>
        <script>

            /**
             * @param {string} name
             * @param {string} url
             * @return {string}
             * */
            function getParameterByName(name, url) {
                if (!url) url = window.location.href;
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, " "));
            }

            /**
             * @param {string} text
             * */
            function clipboardCopy(text) {
                var textField = document.createElement('textarea');
                textField.innerText = text;
                
                window.navigator.clipboard.writeText(textField.value);
            }

            function flattenJson(obj, prefix = '') {
                let result = {};

                for (let key in obj) {
                    if (typeof obj[key] === 'object' && obj[key] !== null) {
                    const nestedPrefix = prefix ? `${prefix}.${key}` : key;
                    result = { ...result, ...flattenJson(obj[key], nestedPrefix) };
                    } else {
                    const finalKey = prefix ? `${prefix}.${key}` : key;
                    result[finalKey] = obj[key];
                    }
                }

                return result;
            }

            window.onload = function() {
                const value = getParameterByName('text', window.location.href)
                const obj = JSON.parse(atob(value))
                
                $('#json-renderer').jsonViewer(obj);

                const list = flattenJson(obj)
                console.log(list)
                
                document.getElementById('list').innerHTML = Object.keys(list).map(key => {
                    return `<li><button onclick="clipboardCopy('${(list[key])}')">${key} copy</button></li>`
                }).join('')
            }
        </script>
    </body>
</html>